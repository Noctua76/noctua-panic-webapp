<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Noctua Panic Web App</title>
  <style>
    :root{
      --bg:#03040a;
      --bg-soft:#0c0f18;
      --card:#11141f;
      --accent:#ff4b4b;
      --accent-soft:#ff8b6a;
      --text:#f5f5fa;
      --muted:#8e93a8;
      --border:#262a36;
      --radius:20px;
      --shadow:0 22px 50px rgba(0,0,0,.75);
      --max-width:460px;
    }

    *{box-sizing:border-box;margin:0;padding:0;}
    html,body{
      height:100%;
      background:
        radial-gradient(circle at top,#202642 0,#03040a 55%);
      color:var(--text);
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
    }

    body{
      display:flex;
      justify-content:center;
      align-items:stretch;
    }

    .app{
      width:100%;
      max-width:var(--max-width);
      min-height:100vh;
      padding:14px 14px 18px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    /* ========== Header ========== */
    .app-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 14px;
      border-radius:999px;
      background:rgba(3,4,15,.92);
      border:1px solid rgba(255,255,255,.06);
      backdrop-filter:blur(18px);
      box-shadow:0 18px 40px rgba(0,0,0,.85);
    }

    .header-left{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .logo{
      width:30px;
      height:30px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(circle at 30% 0%,#ffd27f 0,#ff9b6a 35%,#7849ff 70%,#0d1020 100%);
      box-shadow:0 0 0 1px rgba(255,255,255,.24);
      font-size:18px;
    }

    .header-text{
      display:flex;
      flex-direction:column;
      gap:2px;
    }

    .header-text span{
      font-size:11px;
      color:var(--muted);
      letter-spacing:.05em;
      text-transform:uppercase;
    }

    .header-text strong{
      font-size:14px;
      letter-spacing:.04em;
    }

    .header-right{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:3px;
    }

    .status-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:999px;
      font-size:11px;
      font-weight:500;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.02);
      color:var(--muted);
    }

    .status-dot{
      width:7px;
      height:7px;
      border-radius:50%;
    }

    /* ONLINE */
    .status-pill.online{
      background:rgba(18,212,124,.14);
      border-color:rgba(18,212,124,.55);
      color:#9ff4c6;
    }
    .status-pill.online .status-dot{
      background:#2cf598;
      box-shadow:0 0 8px rgba(44,245,152,.85);
    }

    /* OFFLINE */
    .status-pill.offline{
      background:rgba(255,82,82,.12);
      border-color:rgba(255,82,82,.7);
      color:#ffb3b3;
    }
    .status-pill.offline .status-dot{
      background:#ff5252;
      box-shadow:0 0 8px rgba(255,82,82,.9);
    }

    .header-time{
      font-size:11px;
      color:var(--muted);
    }

    /* ========== Main Layout ========== */
    .app-main{
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:18px;
    }

    .hint-text{
      font-size:12px;
      color:var(--muted);
      text-align:center;
    }

    .hint-text strong{
      color:var(--text);
    }

    /* ========== ALERT PANEL ========== */
    .alert-panel{
      margin-top:4px;
      border-radius:26px;
      background:
        radial-gradient(circle at 0 0,rgba(255,255,255,.04),transparent 55%),
        radial-gradient(circle at 100% 100%,rgba(255,75,75,.18),transparent 55%),
        linear-gradient(145deg,#080914,#131627);
      padding:28px 18px 26px;
      box-shadow:
        0 0 0 1px rgba(255,255,255,.02),
        0 28px 60px rgba(0,0,0,.9);
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:18px;
      position:relative;
    }

    .alert-label{
      text-align:center;
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .alert-label span:first-child{
      font-size:11px;
      letter-spacing:.18em;
      text-transform:uppercase;
      color:var(--muted);
    }

    .alert-label strong{
      font-size:20px;
      letter-spacing:.18em;
      text-transform:uppercase;
    }

    .alert-description{
      font-size:12px;
      color:var(--muted);
    }

    .alert-btn{
      width:150px;
      height:150px;
      border-radius:50%;
      border:none;
      cursor:pointer;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      background:
        radial-gradient(circle at 30% 0%,#ffe4cf 0,#ff8b6a 40%,#ff4b4b 70%,#a6112b 100%);
      box-shadow:
        0 0 0 1px rgba(255,255,255,.16),
        0 0 40px rgba(255,75,75,.72),
        0 26px 40px rgba(0,0,0,.9);
      color:#fff;
      text-transform:uppercase;
      font-weight:700;
      letter-spacing:.18em;
      font-size:14px;
      overflow:hidden;
      transition:transform .08s ease-out, box-shadow .08s ease-out;
    }

    .alert-btn::before{
      content:"";
      position:absolute;
      inset:-40%;
      background:radial-gradient(circle at 50% 0,rgba(255,255,255,.28),transparent 55%);
      opacity:.55;
      pointer-events:none;
    }

    .alert-btn:active{
      transform:scale(.96) translateY(1px);
      box-shadow:
        0 0 0 1px rgba(255,255,255,.2),
        0 0 26px rgba(255,75,75,.85),
        0 18px 28px rgba(0,0,0,.9);
    }

    @keyframes alertPulse{
      0%{ box-shadow:0 0 0 0 rgba(255,75,75,.65); }
      70%{ box-shadow:0 0 0 14px rgba(255,75,75,0); }
      100%{ box-shadow:0 0 0 0 rgba(255,75,75,0); }
    }

    .alert-panel.ready .alert-btn{
      animation:alertPulse 2.4s infinite;
    }

    .alert-note{
      font-size:11px;
      color:var(--muted);
      text-align:center;
    }

    /* ========== STATUS CARD ========== */
    .status-card{
      margin-top:10px;
      border-radius:var(--radius);
      background:var(--card);
      border:1px solid rgba(255,255,255,.06);
      padding:12px 14px;
      font-size:13px;
      display:flex;
      flex-direction:column;
      gap:8px;
      box-shadow:0 16px 40px rgba(0,0,0,.9);
    }

    .status-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
    }

    .status-header-left{
      display:flex;
      align-items:center;
      gap:8px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.08em;
      font-size:12px;
    }

    .status-pulse{
      width:10px;
      height:10px;
      border-radius:50%;
      background:var(--accent);
      box-shadow:0 0 14px rgba(255,75,75,.9);
    }

    .status-badge{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.12);
      color:var(--muted);
    }

    .status-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      color:var(--muted);
      margin-top:6px;
    }

    .status-row strong{
      color:var(--text);
      font-size:13px;
    }

    .status-section{
      margin-top:8px;
      padding-top:8px;
      border-top:1px solid rgba(255,255,255,.06);
    }

    .status-section-title{
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.08em;
      color:var(--muted);
      margin-bottom:4px;
    }

    .status-list{
      list-style:none;
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .status-list li{
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:13px;
      color:var(--text);
    }

    .status-pill-small{
      font-size:11px;
      padding:2px 7px;
      border-radius:999px;
      background:rgba(255,255,255,.03);
      border:1px solid rgba(255,255,255,.12);
      color:var(--muted);
    }

    .status-pill-small.pending{
      background:rgba(255,193,7,.08);
      border-color:rgba(255,193,7,.6);
      color:#ffecb3;
    }

    .status-pill-small.ok{
      background:rgba(18,212,124,.12);
      border-color:rgba(18,212,124,.6);
      color:#a5f3c7;
    }

    .status-pill-small.failed{
      background:rgba(255,82,82,.12);
      border-color:rgba(255,82,82,.7);
      color:#ffc1c1;
    }

    /* ========== Modal ========== */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.78);
      display:flex;
      justify-content:center;
      align-items:center;
      z-index:30;
    }

    .modal{
      width:100%;
      max-width:360px;
      margin:0 18px;
      border-radius:24px;
      background:radial-gradient(circle at 0 0,rgba(255,75,75,.18),transparent 55%),#080a12;
      border:1px solid rgba(255,255,255,.09);
      box-shadow:0 26px 52px rgba(0,0,0,.95);
      padding:20px 20px 16px;
      text-align:center;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .modal-icon{
      font-size:26px;
    }

    .modal-title{
      font-size:16px;
      font-weight:600;
    }

    .modal-text{
      font-size:13px;
      color:var(--muted);
    }

    .modal-countdown{
      font-size:20px;
      letter-spacing:.18em;
      margin-top:4px;
    }

    .modal-actions{
      margin-top:10px;
      display:flex;
      gap:10px;
    }

    .btn{
      flex:1;
      font-size:13px;
      padding:10px 8px;
      border-radius:999px;
      border:none;
      cursor:pointer;
    }

    .btn-secondary{
      background:transparent;
      color:var(--muted);
      border:1px solid rgba(255,255,255,.18);
    }

    .btn-primary{
      background:linear-gradient(145deg,var(--accent),var(--accent-soft));
      color:#fff;
      box-shadow:0 0 18px rgba(255,75,75,.8);
    }
    /* === False Activation Message (auto-cancel) === */
.false-alarm-msg {
  position: fixed;
  bottom: 40px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: rgba(255, 90, 90, 0.15);
  backdrop-filter: blur(6px);
  padding: 14px 22px;
  border-radius: 14px;
  color: #ff7a7a;
  font-size: 15px;
  font-weight: 500;
  opacity: 0;
  transition: all 0.35s ease;
  border: 1px solid rgba(255, 70, 70, 0.3);
  z-index: 40;
}

.false-alarm-msg.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}


    /* ========== Footer ========== */
    .app-footer{
      margin-top:10px;
      font-size:11px;
      color:var(--muted);
      text-align:center;
    }

    .hidden{display:none !important;}

    @media (min-width:600px){
      .app{padding-top:20px;}
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="app-header">
      <div class="header-left">
        <div class="logo">ğŸ¦‰</div>
        <div class="header-text">
          <span>Noctua AI Systems</span>
          <strong>Panic Web App</strong>
        </div>
      </div>
      <div class="header-right">
        <div class="status-pill online" id="systemStatus">
          <span class="status-dot"></span>
          <span class="status-label">Online</span>
        </div>
        <div class="header-time" id="headerClock">--:--</div>
      </div>
    </header>

    <!-- Main -->
    <main class="app-main">
      <p class="hint-text">
        <strong>ÎˆÏ„Î¿Î¹Î¼Î¿ Î³Î¹Î± Ï‡ÏÎ®ÏƒÎ·.</strong> Î Î±Ï„Î®ÏƒÏ„Îµ <strong>ALERT</strong> Î¼ÏŒÎ½Î¿ ÏƒÎµ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ®Ï‚ Î±Ï€ÎµÎ¹Î»Î®Ï‚.
      </p>

      <!-- Alert panel -->
      <section class="alert-panel ready">
        <div class="alert-label">
          <span>Panic Mode</span>
          <strong>ALERT</strong>
          <p class="alert-description">Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· Î¬Î¼ÎµÏƒÎ·Ï‚ ÎµÎ¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ·Ï‚ ÏƒÎµ 3 ÎµÏ€Î±Ï†Î­Ï‚ (ÎºÎ»Î®ÏƒÎµÎ¹Ï‚ + SMS).</p>
        </div>

        <button class="alert-btn" type="button">
          ALERT
        </button>

        <p class="alert-note">
          ÎœÎ¯Î± Ï†Î¿ÏÎ¬ ÎµÎ¯Î½Î±Î¹ Î±ÏÎºÎµÏ„Î® â€“ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Î±Î½Î±Î»Î±Î¼Î²Î¬Î½ÎµÎ¹ Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±.
        </p>
      </section>

      <!-- Status card (default hidden) -->
      <section class="status-card hidden">
        <div class="status-header">
          <div class="status-header-left">
            <span class="status-pulse"></span>
            <span>Î£Ï…Î½Î±Î³ÎµÏÎ¼ÏŒÏ‚ ÎµÎ½ÎµÏÎ³ÏŒÏ‚</span>
          </div>
          <div class="status-badge">Live ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·</div>
        </div>

        <div class="status-row">
          <span>Î§ÏÏŒÎ½Î¿Ï‚ Î±Ï€ÏŒ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·</span>
          <strong>00:07</strong>
        </div>

        <div class="status-section">
          <div class="status-section-title">ğŸ“ ÎšÎ»Î®ÏƒÎµÎ¹Ï‚</div>
          <ul class="status-list">
            <li>
              <span>Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ 1</span>
              <span class="status-pill-small pending">ÎšÎ±Î»ÎµÎ¯Ï„Î±Î¹â€¦</span>
            </li>
            <li>
              <span>Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ 2</span>
              <span class="status-pill-small pending">Î£Îµ Î¿Ï…ÏÎ¬â€¦</span>
            </li>
            <li>
              <span>Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚ 3</span>
              <span class="status-pill-small ok">Î‘Ï€Î±Î½Ï„Î®Î¸Î·ÎºÎµ 14:33</span>
            </li>
          </ul>
        </div>

        <div class="status-section">
          <div class="status-section-title">ğŸ“© SMS</div>
          <ul class="status-list">
            <li>
              <span>SMS 1</span>
              <span class="status-pill-small ok">Î Î±ÏÎ±Î´ÏŒÎ¸Î·ÎºÎµ âœ”ï¸</span>
            </li>
            <li>
              <span>SMS 2</span>
              <span class="status-pill-small pending">Î£Îµ Î±Î½Î±Î¼Î¿Î½Î®â€¦</span>
            </li>
            <li>
              <span>SMS 3</span>
              <span class="status-pill-small ok">Î Î±ÏÎ±Î´ÏŒÎ¸Î·ÎºÎµ âœ”ï¸</span>
            </li>
          </ul>
        </div>
      </section>
      <!-- Incident Report Panel (3-step UI, initially hidden) -->
<section id="incident-assistant" class="assistant-panel hidden" style="margin-top:20px;">
  <h2 style="font-size:16px; margin-bottom:6px;">ÎšÎ±Ï„Î±Î³ÏÎ±Ï†Î® ÏƒÏ…Î¼Î²Î¬Î½Ï„Î¿Ï‚</h2>
  <p id="assistant-intro" style="font-size:13px; color:var(--muted); margin-bottom:14px;">
    ÎŸ ÏƒÏ…Î½Î±Î³ÎµÏÎ¼ÏŒÏ‚ Î­Ï‡ÎµÎ¹ ÏƒÏ„Î±Î»ÎµÎ¯. Î‘Ï€Î¬Î½Ï„Î·ÏƒÎµ ÏƒÎµ 3 ÏƒÏÎ½Ï„Î¿Î¼ÎµÏ‚ ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚.
  </p>

  <div class="assistant-step" style="display:flex; flex-direction:column; gap:10px;">
    <div id="assistant-question"
         class="assistant-question"
         style="font-size:14px; font-weight:500; min-height:42px;">
      <!-- Î•ÏÏÏ„Î·ÏƒÎ· Ï†Î¿ÏÏ„ÏÎ½ÎµÏ„Î±Î¹ ÎµÎ´Ï -->
    </div>

    <textarea id="assistant-answer"
              rows="3"
              placeholder="Î“ÏÎ¬ÏˆÎµ Ï„Î·Î½ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ® ÏƒÎ¿Ï… ÎµÎ´Ïâ€¦"
              style="
                width:100%;
                padding:10px;
                border-radius:12px;
                background:var(--bg-soft);
                border:1px solid rgba(255,255,255,.12);
                color:var(--text);
                font-size:13px;
                resize:none;
              "></textarea>

    <div class="assistant-controls"
         style="display:flex; justify-content:space-between; align-items:center; margin-top:6px;">
      <span id="assistant-progress" style="font-size:12px; color:var(--muted);">
        Î•ÏÏÏ„Î·ÏƒÎ· 1 Î±Ï€ÏŒ 3
      </span>
      <button id="assistant-next-btn"
              type="button"
              style="
                padding:8px 16px;
                border-radius:999px;
                background:linear-gradient(145deg,var(--accent),var(--accent-soft));
                color:white;
                border:none;
                cursor:pointer;
                font-size:13px;
              ">
        Î•Ï€ÏŒÎ¼ÎµÎ½Î¿
      </button>
    </div>
  </div>
</section>
    </main>

    <!-- Footer -->
    <footer class="app-footer">
      Â© Noctua AI Systems â€“ AI Incident Alert Î³Î¹Î± Security (V1)
    </footer>
  </div>

  <!-- Confirm modal -->
  <div class="modal-backdrop hidden">
    <div class="modal">
      <div class="modal-icon">âš ï¸</div>
      <div class="modal-title">Î•Ï€Î¹Î²ÎµÎ²Î±Î¯Ï‰ÏƒÎ· ÏƒÏ…Î½Î±Î³ÎµÏÎ¼Î¿Ï</div>
      <div class="modal-text">
        Î‘Î½ ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÏ„Îµ, Î¸Î± ÎµÎ¹Î´Î¿Ï€Î¿Î¹Î·Î¸Î¿ÏÎ½ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± Î¿Î¹ Ï€ÏÎ¿ÎºÎ±Î¸Î¿ÏÎ¹ÏƒÎ¼Î­Î½ÎµÏ‚ ÎµÏ€Î±Ï†Î­Ï‚ (ÎºÎ»Î®ÏƒÎµÎ¹Ï‚ & SMS).
      </div>
      <div class="modal-countdown">5â€¦</div>
      <div class="modal-text">
        Î Î±Ï„Î®ÏƒÏ„Îµ <strong>ÎÎ±Î¹, ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·</strong> Î¼ÏŒÎ½Î¿ ÏƒÎµ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ¿Ï Ï€ÎµÏÎ¹ÏƒÏ„Î±Ï„Î¹ÎºÎ¿Ï.
      </div>
      <div class="modal-actions">
        <button class="btn btn-secondary" type="button">Î‘ÎºÏÏÏ‰ÏƒÎ·</button>
        <button class="btn btn-primary" type="button">ÎÎ±Î¹, ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·</button>
      </div>
    </div>
  </div>

  <script>
    // ğŸ”¹ Global Î²Î¬ÏƒÎ· Î³Î¹Î± ÏŒÎ»Î± Ï„Î± calls Ï€ÏÎ¿Ï‚ backend
  const BACKEND_BASE = 'https://noctua-panic-backend-production.up.railway.app';

  // Helper Î³Î¹Î± Î³ÏÎ®Î³Î¿ÏÎ¿ query
  const $ = (s) => document.querySelector(s);

  // Î’Î±ÏƒÎ¹ÎºÎ¬ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± UI
  const alertBtn        = $('.alert-btn');
  const statusCard      = $('.status-card');
  const modalBackdrop   = $('.modal-backdrop');
  const countdownEl     = $('.modal-countdown');
  const statusBadge     = document.querySelector('.status-badge');
  const timeFromStartEl = document.querySelector('.status-row strong');

  // ÎšÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚
  let countdownTimer    = null;
  let activeTimer       = null;
  let startTimestamp    = null;
  let autoCancelTimeout = null;

  // ===== 1. Î Î¬Ï„Î·Î¼Î± ALERT â†’ Î±Î½Î¿Î¯Î³ÎµÎ¹ modal =====
  if (alertBtn) {
    alertBtn.addEventListener('click', () => {
      openConfirmModal();
    });
  }

  function openConfirmModal() {
    if (!modalBackdrop) return;
    modalBackdrop.classList.remove('hidden');

    startCountdown(5);            // Î¾ÎµÎºÎ¹Î½Î¬ Ï„Î¿ countdown
    startAutoCancelCountdown();   // Î±Î½ Î´ÎµÎ½ Ï€Î±Ï„Î·Î¸ÎµÎ¯ Ï„Î¯Ï€Î¿Ï„Î± â†’ auto-cancel

    attachModalHandlers();
  }

  function closeConfirmModal() {
    if (!modalBackdrop) return;
    modalBackdrop.classList.add('hidden');

    cancelAutoCancelCountdown();  // ÏƒÏ„Î±Î¼Î±Ï„Î¬ Ï„Î¿ auto-cancel Î±Î½ Ï„ÏÎ­Ï‡ÎµÎ¹
    stopCountdown();              // ÏƒÏ„Î±Î¼Î±Ï„Î¬ Ï„Î¿ ÏÎ¿Î»ÏŒÎ¹ ÏƒÏ„Î¿ modal
  }

  function attachModalHandlers() {
    const cancelButton  = document.querySelector('.btn.btn-secondary');
    const confirmButton = document.querySelector('.btn.btn-primary');

    if (cancelButton) {
      cancelButton.onclick = () => {
        cancelAutoCancelCountdown();
        closeConfirmModal();
      };
    }

    if (confirmButton) {
      confirmButton.onclick = async () => {
        cancelAutoCancelCountdown();
        closeConfirmModal();
        await handleAlertConfirmed();
      };
    }
  }

  function startCountdown(seconds) {
    if (!countdownEl) return;
    let remaining = seconds;
    countdownEl.textContent = `${remaining}â€¦`;

    countdownTimer = setInterval(() => {
      remaining--;
      if (remaining <= 0) {
        stopCountdown();
      } else {
        countdownEl.textContent = `${remaining}â€¦`;
      }
    }, 1000);
  }

  function stopCountdown() {
    if (countdownTimer) {
      clearInterval(countdownTimer);
      countdownTimer = null;
    }
  }

  async function handleAlertConfirmed() {
  if (statusCard) {
    statusCard.classList.remove('hidden');
  }

  startTimestamp = Date.now();
  startActiveTimer();

  if (statusBadge) {
    statusBadge.textContent = 'Î•Î¹Î´Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÏƒÎµ ÎµÎ¾Î­Î»Î¹Î¾Î·';
  }

  try {
    // 1) Î•Î½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ»Î®ÏƒÎµÏ‰Î½ / SMS
    await triggerAlert();

    // 2) Î‘Ï€Î¿ÏƒÏ„Î¿Î»Î® incident log ÏƒÏ„Î¿ backend Î³Î¹Î± AI ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®
    const baseMessage =
      "Panic button activated via Noctua Panic Web App. Guard confirmed real incident.";
    await sendIncidentToBackend(baseMessage);

  } catch (err) {
    console.error('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ·:', err);
    if (statusBadge) {
      statusBadge.textContent = 'Î£Ï†Î¬Î»Î¼Î± â€“ Î±Ï€Î±Î¹Ï„ÎµÎ¯Ï„Î±Î¹ Î­Î»ÎµÎ³Ï‡Î¿Ï‚';
    }
  }

  // ğŸ‘‰ Î•Î”Î© Ï€ÏÎ¿ÏƒÏ„Î¯Î¸ÎµÏ„Î±Î¹ Ï„Î¿ incident UI flow
  setTimeout(() => {
    startIncidentFlowUI();
  }, 15000); // 15" Î³Î¹Î± Î´Î¿ÎºÎ¹Î¼Î® â€“ Î¼ÎµÏ„Î¬ 300000 (5 Î»ÎµÏ€Ï„Î¬)
}

  function startActiveTimer() {
    if (!timeFromStartEl) return;

    activeTimer = setInterval(() => {
      if (!startTimestamp) return;
      const diffMs   = Date.now() - startTimestamp;
      const totalSec = Math.floor(diffMs / 1000);
      const mm       = String(Math.floor(totalSec / 60)).padStart(2, '0');
      const ss       = String(totalSec % 60).padStart(2, '0');
      timeFromStartEl.textContent = `${mm}:${ss}`;
    }, 1000);
  }

  // ===== ALERT Ï€ÏÎ¿Ï‚ backend =====
  async function triggerAlert() {
    const endpoint = `${BACKEND_BASE}/alert`;   // Î±Î½ Ï„Î¿ route ÎµÎ¯Î½Î±Î¹ Î¬Î»Î»Î¿, Î¬Î»Î»Î±Î¾Î­ Ï„Î¿

    const payload = {
      siteId:      'SITE_123',
      guardId:     'GUARD_001',
      source:      'noctua-panic-webapp',
      triggeredAt: new Date().toISOString()
    };

    const response = await fetch(endpoint, {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
      throw new Error('Alert request failed with status ' + response.status);
    }
  }

  // ===== Incident log Ï€ÏÎ¿Ï‚ backend /incident-log (AI Assistant) =====
  async function sendIncidentToBackend(message) {
    try {
      const endpoint = `${BACKEND_BASE}/incident-log`;

      const payload = {
        guardId: "GUARD_001",
        siteId: "SITE_123",
        timestamp: new Date().toISOString(),
        message: message
      };

      const response = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        console.error("Incident-log request failed with status", response.status);
        return;
      }

      const data = await response.json();
      console.log("Incident-log response:", data);

      if (data.assistantLog) {
        alert("AI incident summary:\n\n" + data.assistantLog);
      }
    } catch (err) {
      console.error("Error sending incident log:", err);
    }
  }
    
    // ===== Detailed incident log Ï€ÏÎ¿Ï‚ backend (3 answers) =====
async function sendIncidentDetailsToBackend(answers) {
  const endpoint = `${BACKEND_BASE}/incident-log`;

  // ÎœÏ€Î¿ÏÎ¿ÏÎ¼Îµ Î½Î± Ï‡ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¹Î®ÏƒÎ¿Ï…Î¼Îµ Ï„Î± Î¯Î´Î¹Î± guard/site Î¼Îµ Ï€ÏÎ¹Î½
  const payload = {
    guardId: "GUARD_001",
    siteId: "SITE_123",
    timestamp: new Date().toISOString(),
    incidentAnswers: answers,
    message: `
      Incident follow-up (3-question flow).

      Type of incident: ${answers.incident_type || '-'}
      Location: ${answers.location || '-'}
      Actions taken: ${answers.actions_taken || '-'}
    `
  };

  const response = await fetch(endpoint, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  if (!response.ok) {
    console.error("Detailed incident-log request failed with status", response.status);
    return;
  }

  const data = await response.json();
  console.log("Detailed incident-log response:", data);

  // Î‘Î½ Î¸ÎµÏ‚, Î¼Ï€Î¿ÏÎµÎ¯Ï‚ Î½Î± ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÎ¹Ï‚ Ï„Î· ÏƒÏÎ½Î¿ÏˆÎ· Ï„Î¿Ï… AI:
  if (data.assistantLog) {
    console.log("AI incident summary:", data.assistantLog);
    // Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬:
    // alert("AI incident summary:\n\n" + data.assistantLog);
  }
}

  // ===== LIVE CLOCK (Header) =====
  function updateHeaderClock(){
    const clockEl = document.getElementById('headerClock');
    if (!clockEl) return;

    const now = new Date();
    clockEl.textContent = now.toLocaleTimeString('el-GR', {
      hour: '2-digit',
      minute: '2-digit'
    });
  }

  updateHeaderClock();
  setInterval(updateHeaderClock, 1000);

  // ===== SYSTEM STATUS CHECK (Online / Offline) =====
  const statusEl      = document.getElementById('systemStatus');
  const statusLabelEl = statusEl?.querySelector('.status-label');
  const HEALTH_ENDPOINT = `${BACKEND_BASE}/health`;

  function setSystemStatus(mode){
    if (!statusEl || !statusLabelEl) return;

    statusEl.classList.remove('online','offline');

    if (mode === 'online'){
      statusEl.classList.add('online');
      statusLabelEl.textContent = 'Online';
    } else {
      statusEl.classList.add('offline');
      statusLabelEl.textContent = 'Offline';
    }
  }

  async function checkSystemStatus(){
    try{
      // ÎŒÏ„Î±Î½ Î¸Î± Î­Ï‡ÎµÎ¹Ï‚ Ï…Î»Î¿Ï€Î¿Î¹Î®ÏƒÎµÎ¹ Ï„Î¿ /health:
      // const res  = await fetch(HEALTH_ENDPOINT, { cache:'no-store' });
      // const data = await res.json();
      // if (data.status === 'ok') setSystemStatus('online');
      // else setSystemStatus('offline');

      // Î ÏÎ¿Ï‚ Ï„Î¿ Ï€Î±ÏÏŒÎ½: Ï€Î¬Î½Ï„Î± Online
      setSystemStatus('online');

    }catch(err){
      console.error('Health check failed:', err);
      setSystemStatus('offline');
    }
  }

  checkSystemStatus();
  // setInterval(checkSystemStatus, 30000);

  /* ==========================================
     AUTO-CANCEL AFTER COUNTDOWN (NO ACTION)
  ========================================== */

  function startAutoCancelCountdown() {
    if (autoCancelTimeout) {
      clearTimeout(autoCancelTimeout);
      autoCancelTimeout = null;
    }

    autoCancelTimeout = setTimeout(() => {
      autoCancelTimeout = null;

      if (!modalBackdrop.classList.contains('hidden')) {
        closeConfirmModal();
        showFalseAlarmMessage();
      }
    }, 5500);
  }

  function cancelAutoCancelCountdown() {
    if (autoCancelTimeout) {
      clearTimeout(autoCancelTimeout);
      autoCancelTimeout = null;
    }
  }

  /* ==========================================
     ÎœÎ®Î½Ï…Î¼Î± "Î•ÏƒÏ†Î±Î»Î¼Î­Î½Î· ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ±Ï„Î±Î³ÏÎ¬Ï†Î·ÎºÎµ"
  ========================================== */

  function showFalseAlarmMessage() {
    const msg = document.createElement('div');
    msg.className = 'false-alarm-msg';
    msg.textContent = 'âš ï¸ Î•ÏƒÏ†Î±Î»Î¼Î­Î½Î· ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¯Î·ÏƒÎ· ÎºÎ±Ï„Î±Î³ÏÎ¬Ï†Î·ÎºÎµ';

    document.body.appendChild(msg);

    setTimeout(() => {
      msg.classList.add('show');
    }, 50);

    setTimeout(() => {
      msg.classList.remove('show');
      setTimeout(() => msg.remove(), 400);
    }, 2000);
  }
    function resetWebAppUI() {
    // ÎšÏÏÎ²Î¿Ï…Î¼Îµ Ï„Î·Î½ ÎºÎ¬ÏÏ„Î± ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·Ï‚
    if (statusCard) {
      statusCard.classList.add('hidden');
    }

    // Î£Ï„Î±Î¼Î±Ï„Î¬Î¼Îµ Ï„Î¿ Ï‡ÏÎ¿Î½ÏŒÎ¼ÎµÏ„ÏÎ¿
    if (activeTimer) {
      clearInterval(activeTimer);
      activeTimer = null;
    }
    startTimestamp = null;

    // ÎœÎ·Î´ÎµÎ½Î¯Î¶Î¿Ï…Î¼Îµ Ï„Î·Î½ Î­Î½Î´ÎµÎ¹Î¾Î· Ï‡ÏÏŒÎ½Î¿Ï…
    if (timeFromStartEl) {
      timeFromStartEl.textContent = '00:00';
    }

    // Î•Ï€Î±Î½Î±Ï†Î­ÏÎ¿Ï…Î¼Îµ Ï„Î¿ badge
    if (statusBadge) {
      statusBadge.textContent = 'Live ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·';
    }
  }
    /* =====================================================
    INCIDENT REPORT UI (3 ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚ â€“ Ï‡Ï‰ÏÎ¯Ï‚ backend Î±ÎºÏŒÎ¼Î±)
===================================================== */

// ÎŸÎ¹ 3 ÎµÏÏ‰Ï„Î®ÏƒÎµÎ¹Ï‚
const incidentQuestions = [
  {
    key: 'incident_type',
    text: 'Î¤Î¹ ÎµÎ¯Î´Î¿Ï…Ï‚ Ï€ÎµÏÎ¹ÏƒÏ„Î±Ï„Î¹ÎºÏŒ Î®Ï„Î±Î½; (Ï€.Ï‡. Ï€Î±ÏÎ±Î²Î¯Î±ÏƒÎ· Ï‡ÏÏÎ¿Ï…, ÏÏ€Î¿Ï€Ï„Î¿ Î¬Ï„Î¿Î¼Î¿, ÏˆÎµÏ…Î´Î®Ï‚ ÏƒÏ…Î½Î±Î³ÎµÏÎ¼ÏŒÏ‚, Ï„ÎµÏ‡Î½Î¹ÎºÏŒ Î¶Î®Ï„Î·Î¼Î±, test)'
  },
  {
    key: 'location',
    text: 'Î Î¿Ï Î±ÎºÏÎ¹Î²ÏÏ‚ ÎµÎ½Ï„Î¿Ï€Î¯ÏƒÏ„Î·ÎºÎµ; (Ï€.Ï‡. ÎµÎ¯ÏƒÎ¿Î´Î¿Ï‚, Î¶ÏÎ½Î· Î’2, Ï€ÏÎ¿Î±ÏÎ»Î¹Î¿Ï‚ Ï‡ÏÏÎ¿Ï‚)'
  },
  {
    key: 'actions_taken',
    text: 'ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎµÏ‚ Ï„Î¹Ï‚ Î±Ï€Î±Î¹Ï„Î¿ÏÎ¼ÎµÎ½ÎµÏ‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹ÎµÏ‚; Î¤Î¹ Î­ÎºÎ±Î½ÎµÏ‚;'
  }
];

let currentQuestionIndex = 0;
let incidentAnswers = {};

// ÎˆÎ½Î±ÏÎ¾Î· UI
function startIncidentFlowUI() {
  const panel      = document.getElementById('incident-assistant');
  const qEl        = document.getElementById('assistant-question');
  const progressEl = document.getElementById('assistant-progress');
  const answerEl   = document.getElementById('assistant-answer');

  incidentAnswers = {};
  currentQuestionIndex = 0;

  qEl.textContent = incidentQuestions[0].text;
  progressEl.textContent = `Î•ÏÏÏ„Î·ÏƒÎ· 1 Î±Ï€ÏŒ ${incidentQuestions.length}`;
  answerEl.value = '';

  panel.classList.remove('hidden');
}

// Next button
document.getElementById('assistant-next-btn')?.addEventListener('click', () => {
  const answerEl = document.getElementById('assistant-answer');
  const qEl      = document.getElementById('assistant-question');
  const progressEl = document.getElementById('assistant-progress');
  const panel = document.getElementById('incident-assistant');

  const answer = answerEl.value.trim();
  if (!answer) {
    alert('Î“ÏÎ¬ÏˆÎµ Î¼Î¹Î± ÏƒÏÎ½Ï„Î¿Î¼Î· Î±Ï€Î¬Î½Ï„Î·ÏƒÎ· Ï€ÏÎ¹Î½ ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÎ¹Ï‚.');
    return;
  }

  // Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Ï„Î·Ï‚ Î±Ï€Î¬Î½Ï„Î·ÏƒÎ·Ï‚
  const key = incidentQuestions[currentQuestionIndex].key;
  incidentAnswers[key] = answer;

  currentQuestionIndex++;

  if (currentQuestionIndex < incidentQuestions.length) {
    // Î•Ï€ÏŒÎ¼ÎµÎ½Î· ÎµÏÏÏ„Î·ÏƒÎ·
    qEl.textContent = incidentQuestions[currentQuestionIndex].text;
    progressEl.textContent = `Î•ÏÏÏ„Î·ÏƒÎ· ${currentQuestionIndex+1} Î±Ï€ÏŒ ${incidentQuestions.length}`;
    answerEl.value = '';
  } else {
    // Î¤Î­Î»Î¿Ï‚ Ï„Ï‰Î½ 3 ÎµÏÏ‰Ï„Î®ÏƒÎµÏ‰Î½
    console.log('Incident answers:', incidentAnswers);

    // Î£Ï„Î­Î»Î½Î¿Ï…Î¼Îµ Ï„Î¹Ï‚ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ backend Î³Î¹Î± AI ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î®
    sendIncidentDetailsToBackend(incidentAnswers)
      .catch(err => {
        console.error('Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î·Î½ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î® incident details:', err);
      })
      .finally(() => {
        alert('Î— ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î® Ï„Î¿Ï… ÏƒÏ…Î¼Î²Î¬Î½Ï„Î¿Ï‚ Î¿Î»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ.');
        panel.classList.add('hidden');
        resetWebAppUI();
      });
  }   // â† ÎšÎ»ÎµÎ¯Î½ÎµÎ¹ Ï„Î¿ if Ï„Î¿Ï… currentQuestionIndex
});   // â† ÎšÎ›Î•Î™ÎÎ•Î™ Ï„Î¿ addEventListener

</script>
</body>
</html>
